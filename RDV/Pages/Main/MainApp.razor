@page "/mainApp"
@layout AppLayout

@using Microsoft.AspNetCore.Http
@using BLL.Admin.Interfaces
@using Models.Admin

@inject IUsuarioBLL usuarioBLL
@inject NavigationManager NavigationManager
@inject IHttpContextAccessor httpContextAccessor


<h1>Sistema de RDV</h1>

@code {



    protected override async Task OnAfterRenderAsync(bool firstRender)
    {


        var email = httpContextAccessor.HttpContext.Session.GetString("usuario");
        if (!string.IsNullOrEmpty(email))
        {
            Usuario usuario = await usuarioBLL.GetUsuarioPeloEmail(email);
            if (await usuarioBLL.UsuarioEstaLogado(usuario))
            {
                await base.OnAfterRenderAsync(firstRender);

            }
        }
        else
        {

            NavigationManager.NavigateTo("loginView");
            return;
        }
    }


    //protected override async void OnInitialized()
    //{
    //    var email = httpContextAccessor.HttpContext.Session.GetString("usuario");
    //    if (!string.IsNullOrEmpty(email))
    //    {
    //        Usuario usuario = await usuarioBLL.GetUsuarioPeloEmail(email);
    //        if (await usuarioBLL.UsuarioEstaLogado(usuario))
    //        {
    //            base.OnInitialized();

    //        }
    //    }
    //    else
    //    {
    //        base.OnInitialized();
    //        NavigationManager.NavigateTo("loginView");
    //        return;
    //    }
    //}

}
